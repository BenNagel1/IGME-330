(()=>{"use strict";var e,t,r,n,o,c,a,i=Object.freeze({gain:.5,numSamples:256}),l=(new Uint8Array(i.numSamples/2),function(e){t.src=e});function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var s,f,h,d,y,m,g=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return"rgba(".concat(e,",").concat(t,",").concat(r,",").concat(n,")")};function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function w(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,p(n.key),n)}}function p(e){var t=function(e){if("object"!=b(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=b(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==b(t)?t:t+""}var S,k,q,T,A=function(){return e=function e(t,r,n,o,c,a,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t,this.y=r,this.width=n,this.height=o,this.fill=c,this.stroke=a,this.wave=i},t=[{key:"update",value:function(e,t){this.x=e,this.y=t}},{key:"draw",value:function(e){e.save(),e.beginPath(),e.fillStyle=this.fill,e.strokeStyle=this.stroke,e.lineWidth=5,e.ellipse(this.x,this.y,this.width,this.height,Math.PI/2,0,2*Math.PI),e.fill(),e.stroke(),e.closePath(),e.restore()}}],t&&w(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),P=[],E=function(e,t){s=e.getContext("2d"),f=e.width,h=e.height,d=function(e,t,r,n,o){var c,a=e.createLinearGradient(0,0,0,o),i=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,a=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){i=!0,c=e},f:function(){try{a||null==r.return||r.return()}finally{if(i)throw c}}}}([{percent:0,color:"#1F214D"},{percent:.5,color:"#BF3475"},{percent:1,color:"#EE6C45"}]);try{for(i.s();!(c=i.n()).done;){var l=c.value;a.addColorStop(l.percent,l.color)}}catch(e){i.e(e)}finally{i.f()}return a}(s,0,0,0,h),y=t,m=new Uint8Array(y.fftSize/2),P[0]=new A(100,100,25,50,"red","darkred",20),P[1]=new A(100,100,25,50,"lime","green",70)},I={showGradient:!0,showBars:!0,showCircles:!0,showNoise:!1,showInvert:!1,showEmboss:!1,toggleLowshelf:!1,toggleHighshelf:!1,toggleWaveform:!1},C=function(){var u,s;!function(e,t,r){var n=new XMLHttpRequest;n.open("GET","./data/av-data.json",!0),n.onload=function(){if(200===n.status)try{var e=JSON.parse(n.responseText);t(e.title),r(e.tracks),c=e.filters.bass,q=c,o=e.filters.treble,T=o}catch(e){console.error("Error parsing JSON:",e)}else console.error("Failed to load data");var o,c},n.onerror=function(){return console.error("XHR request error")},n.send()}(0,(function(e){S=e,document.title=S,document.querySelector("#title").innerHTML=S}),(function(e){k=e;var t=Object.values(k).map((function(e){return e.trackName}));document.querySelector("#data-list").innerHTML="<ul>".concat(t.map((function(e){return"<li>".concat(e,"</li>")})).join(""),"</ul>")})),u=M.sound1,s=window.AudioContext||window.webkitAudioContext,e=new s,t=new Audio,l(u),r=e.createMediaElementSource(t),n=e.createAnalyser(),(c=e.createBiquadFilter()).type="lowshelf",(a=e.createBiquadFilter()).type="highshelf",n.fftSize=i.numSamples,(o=e.createGain()).gain.value=i.gain,r.connect(c),c.connect(a),a.connect(n),n.connect(o),o.connect(e.destination);var f=document.querySelector("canvas");F(f),E(f,n),z()},M=Object.freeze({sound1:"./media/New Adventure Theme.mp3"}),F=function(r){document.querySelector("#btn-fullscreen").onclick=function(e){var t;(t=r).requestFullscreen?t.requestFullscreen():t.mozRequestFullscreen?t.mozRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()};var n=document.querySelector("#btn-play");n.onclick=function(r){"suspended"==e.state&&e.resume(),"no"==r.target.dataset.playing?(t.play(),r.target.dataset.playing="yes"):(t.pause(),r.target.dataset.playing="no")};var c=document.querySelector("#slider-volume"),a=document.querySelector("#label-volume");c.oninput=function(e){var t;t=e.target.value,t=Number(t),o.gain.value=t,a.innerHTML=Math.round(e.target.value/2*100)},c.dispatchEvent(new Event("input")),document.querySelector("#select-track").onchange=function(e){l(e.target.value),"yes"==n.dataset.playing&&n.dispatchEvent(new MouseEvent("click"))},document.querySelector("#cb-gradient").checked=I.showGradient,document.querySelector("#cb-bars").checked=I.showBars,document.querySelector("#cb-circles").checked=I.showCircles,document.querySelector("#cb-noise").checked=I.showNoise,document.querySelector("#cb-invert").checked=I.showInvert,document.querySelector("#cb-emboss").checked=I.showEmboss,document.querySelector("#cb-lowshelf").checked=I.toggleLowshelf,document.querySelector("#cb-highshelf").checked=I.toggleHighshelf,document.querySelector("#cb-waveform").checked=I.toggleWaveform,document.querySelector("#cb-gradient").onclick=function(e){I.showGradient=e.target.checked},document.querySelector("#cb-bars").onclick=function(e){I.showBars=e.target.checked},document.querySelector("#cb-circles").onclick=function(e){I.showCircles=e.target.checked},document.querySelector("#cb-noise").onclick=function(e){I.showNoise=e.target.checked},document.querySelector("#cb-invert").onclick=function(e){I.showInvert=e.target.checked},document.querySelector("#cb-emboss").onclick=function(e){I.showEmboss=e.target.checked},document.querySelector("#cb-lowshelf").onclick=function(e){I.toggleLowshelf=e.target.checked,j()},document.querySelector("#cb-highshelf").onclick=function(e){I.toggleHighshelf=e.target.checked,R()},document.querySelector("#cb-waveform").onclick=function(e){I.toggleWaveform=e.target.checked}},j=function(){I.toggleLowshelf?(c.frequency.setValueAtTime(1e3,e.currentTime),c.gain.setValueAtTime(q,e.currentTime)):c.gain.setValueAtTime(0,e.currentTime)},R=function(){I.toggleHighshelf?(a.frequency.setValueAtTime(1e3,e.currentTime),a.gain.setValueAtTime(T,e.currentTime)):a.gain.setValueAtTime(0,e.currentTime)},z=function(){setTimeout(z,1e3/60),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(I.toggleWaveform?y.getByteTimeDomainData(m):y.getByteFrequencyData(m),s.save(),s.fillStyle="black",s.globalAlpha=.1,s.fillRect(0,0,f,h),s.restore(),e.showGradient&&(s.save(),s.fillStyle=d,s.globalAlpha=.3,s.fillRect(0,0,f,h),s.restore()),e.showCircles){var t=h/4;s.save(),s.globalAlpha=.5;for(var r=0;r<m.length;r++){var n=m[r]/255,o=n*t;s.beginPath(),s.fillStyle=g(200,200,0,.34-n/3),s.arc(f/2,h/3,o,0,2*Math.PI,!1),s.fill(),s.closePath(),s.beginPath(),s.fillStyle=g(200,150,0,.1-n/10),s.arc(f/2,h/3,1.5*o,0,2*Math.PI,!1),s.fill(),s.closePath(),s.beginPath(),s.fillStyle=g(200,250,0,.5-n/5),s.arc(f/2,h/3,.5*o,0,2*Math.PI,!1),s.fill(),s.closePath()}s.restore()}if(e.showBars){var c=(f-4*m.length-10)/m.length*2;s.save(),s.strokeStyle="rgba(22, 105, 138, 0.5)",s.lineWidth=4;for(var a=0;a<m.length;a++){s.fillStyle="rgba(80, ".concat(200-2*a,", 255, .8)"),s.fillRect(a*(c+4),406-m[a],c,350),s.strokeRect(a*(c+4),406-m[a],c,350);for(var i=0,l=P;i<l.length;i++){var u=l[i];a==u.wave&&u.update(a*(c+4),406-m[a])}}s.restore();for(var b=0,w=P;b<w.length;b++){var p=w[b];p.y<400&&p.draw(s)}var S,k=0,q=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return v(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?v(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,a=!0,i=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){i=!0,c=e},f:function(){try{a||null==r.return||r.return()}finally{if(i)throw c}}}}(m);try{for(q.s();!(S=q.n()).done;)k+=S.value}catch(e){q.e(e)}finally{q.f()}k/=m.length,s.save(),s.fillStyle="#e1bf92",s.strokeStyle="#b08d5f",s.lineWidth=5,s.globalAlpha=k>50?1:k/50,s.beginPath(),s.moveTo(-50,375),s.bezierCurveTo(-50,367,100,343,190,342),s.bezierCurveTo(250,341,400,374,500,374),s.bezierCurveTo(730,351,750,340,850,375),s.lineTo(850,475),s.lineTo(-50,475),s.closePath(),s.fill(),s.stroke(),s.restore()}for(var T=s.getImageData(0,0,f,h),A=T.data,E=A.length,C=T.width,M=0;M<E;M+=4)if(e.showNoise&&Math.random()<.05&&(A[M]=A[M+1]=A[M+2]=0,A[M]=255,A[M+1]=255,A[M+2]=255),e.showInvert){var F=A[M],j=A[M+1],R=A[M+2];A[M]=255-F,A[M+1]=255-j,A[M+2]=255-R}if(e.showEmboss)for(var z=0;z<E;z++)z%4!=3&&(A[z]=127+2*A[z]-A[z+4]-A[z+4*C]);s.putImageData(T,0,0)}(I)};window.onload=function(){C()}})();